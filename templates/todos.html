{% extends "base.html" %}
{% block title %}Action Items â€” Standup 3000{% endblock %}
{% block content %}
<h2>Action Items</h2>

<form method="get" class="todo-filters" style="display:flex; gap:0.5rem; flex-wrap:wrap; margin-bottom:1.5rem; align-items:end;">
    <div>
        <label for="f-assignee" style="font-size:0.75rem;">Assignee</label>
        <select id="f-assignee" name="assignee" style="font-size:0.85rem; padding:0.3rem 0.5rem; margin-bottom:0;">
            <option value="">All</option>
            <option value="unassigned" {% if filters.assignee == 'unassigned' %}selected{% endif %}>Unassigned</option>
            {% for u in users %}
            <option value="{{ u.id }}" {% if filters.assignee == u.id|string %}selected{% endif %}>{{ u.display_name }}</option>
            {% endfor %}
        </select>
    </div>
    <div>
        <label for="f-priority" style="font-size:0.75rem;">Priority</label>
        <select id="f-priority" name="priority" style="font-size:0.85rem; padding:0.3rem 0.5rem; margin-bottom:0;">
            <option value="">All</option>
            <option value="high" {% if filters.priority == 'high' %}selected{% endif %}>High</option>
            <option value="normal" {% if filters.priority == 'normal' %}selected{% endif %}>Normal</option>
            <option value="low" {% if filters.priority == 'low' %}selected{% endif %}>Low</option>
        </select>
    </div>
    <div style="display:flex; gap:1rem; align-items:center;">
        <label style="font-size:0.85rem; margin-bottom:0; display:flex; align-items:center; gap:0.3rem;">
            <input type="checkbox" name="overdue" value="1" {% if filters.overdue %}checked{% endif %} style="margin:0; width:1rem; height:1rem;">
            Overdue only
        </label>
        <label style="font-size:0.85rem; margin-bottom:0; display:flex; align-items:center; gap:0.3rem;">
            <input type="checkbox" name="show_done" value="1" {% if filters.show_done %}checked{% endif %} style="margin:0; width:1rem; height:1rem;">
            Show completed
        </label>
    </div>
    <button type="submit" style="font-size:0.8rem; padding:0.35rem 0.8rem; border-radius:6px; margin-bottom:0;">Filter</button>
    {% if filters.assignee or filters.priority or filters.overdue or filters.show_done %}
    <a href="{{ url_for('todos_dashboard') }}" style="font-size:0.8rem; opacity:0.6;">Clear</a>
    {% endif %}
</form>

{% if grouped %}
{% for date, sections in grouped.items() %}
<div class="todo-meeting-group">
    <h3 class="todo-meeting-date">{{ date }}</h3>
    {% for section_name, info in sections.items() %}
    <div class="todo-section-group">
        <div class="todo-section-header">
            <strong>{{ section_name }}</strong>
            {% if info.reporter %}
            <span class="reporter">{{ info.reporter }}</span>
            {% endif %}
        </div>
        {% for todo in info.todos %}
            {% include "partials/todo_item.html" %}
        {% endfor %}
    </div>
    {% endfor %}
</div>
{% endfor %}
{% else %}
<p style="opacity:0.5; font-style:italic;">No action items match your filters. Nice work!</p>
{% endif %}
{% endblock %}
